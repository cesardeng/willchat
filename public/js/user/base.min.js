var Base=function(){var e=function(){$(".btn-delete-confirm").confirmation({title:"确定删除？",singleton:!0,popout:!0,btnOkClass:"btn-xs btn-danger",btnOkLabel:"是",btnCancelClass:"btn-xs btn-default",btnCancelLabel:"否",onConfirm:function(){var e=$(this).data("link");$.get(e,function(e){e.status?(Base.success(e.info),setTimeout(function(){location.href=e.url},1e3)):Base.error(e.info)},"json")}})},t=function(){$("form").not(".validate").submit(function(e){var t=$(this).attr("action"),i=$(this).serialize();return $.ajax({url:t,type:"POST",dataType:"json",data:i}).done(function(e,t,i){var n=$("form");n.find(".alert").remove(),Base.success(e.info),e.url?setTimeout(function(){top.location.href=e.url},2e3):setTimeout(function(){top.location.reload()},2e3)}).fail(function(e,t,i){var n=e.responseJSON,o=$("form");o.find(".alert").remove(),$.each(n,function(e,t){var i=t[0],n=$('<div class="alert alert-danger alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true"></button><strong>验证错误!</strong> '+i+" </div>");o.prepend(n)})}).always(function(){console.log("complete")}),!1})},i=function(){$("img.preview-small,.thumbnail img").click(function(e){var t=$(this).attr("src"),i="<img src='"+t+"' height='300'/>";layer.open({type:1,title:!1,fix:!1,shadeClose:!0,offset:["150px",""],area:["auto","auto"],content:i})})},n=function(){$(".group-checkable").click(function(){$(".ids").prop("checked",this.checked),$(".group-checkable,.ids").uniform()}),$(".ids").click(function(){var e=$(".ids");e.each(function(e){return this.checked?($(".group-checkable").prop("checked",!0),void $(".group-checkable,.ids").uniform()):($(".group-checkable").prop("checked",!1),$(".group-checkable,.ids").uniform(),!1)})})};$(".ajax-get").click(function(){var e;return!($(this).hasClass("confirm")&&!c("确认要执行该操作吗?"))&&(((e=$(this).attr("href"))||(e=$(this).attr("url")))&&$.get(e).success(function(e){1==e.status?(e.url?Base.success(e.info+" 页面即将自动跳转~"):Base.success(e.info),setTimeout(function(){e.url?location.href=e.url:location.reload()},1500)):(Base.error(e.info),setTimeout(function(){e.url&&(location.href=e.url)},1500))}),!1)}),$(".ajax-post").click(function(){var e,t,i,n=$(this).attr("target-form"),o=this,a=!1;if("submit"==$(this).attr("type")||(e=$(this).attr("href"))||(e=$(this).attr("url"))){if(i=$("."+n),"true"===$(this).attr("hide-data"))i=$(".hide-data"),t=i.serialize();else{if(void 0==i.get(0))return!1;if("FORM"==i.get(0).nodeName){if($(this).hasClass("confirm")&&!c("确认要执行该操作吗?"))return!1;e=void 0!==$(this).attr("url")?$(this).attr("url"):i.get(0).action,t=i.serialize()}else if("INPUT"==i.get(0).nodeName||"SELECT"==i.get(0).nodeName||"TEXTAREA"==i.get(0).nodeName){if(i.each(function(e,t){"checkbox"==t.type&&1==t.checked&&(a=!0)}),a&&$(this).hasClass("confirm")&&!c("确认要执行该操作吗?"))return!1;t=i.serialize()}else{if($(this).hasClass("confirm")&&!c("确认要执行该操作吗?"))return!1;t=i.find("input,select,textarea").serialize()}}$(o).addClass("disabled").attr("autocomplete","off").prop("disabled",!0),$.post(e,t).success(function(e){1==e.status?(e.url?Base.success(e.info+" 页面即将自动跳转~"):Base.success(e.info),setTimeout(function(){$(o).removeClass("disabled").prop("disabled",!1),e.url?location.href=e.url:location.reload()},1500)):(Base.error(e.info),setTimeout(function(){$(o).removeClass("disabled").prop("disabled",!1),e.url&&(location.href=e.url)},1500))})}return!1});var o=function(){var e=$(".page-sidebar-menu .nav-item").find("a");if(e.length>0){var t=document.URL,i=$(".page-sidebar-menu .nav-item").find("a[href='"+t+"']").first();if(i){var n=i.index(e);Cookies.set("menuindex",n),Layout.setSidebarMenuActiveLink("click",i)}else{var n=Cookies.get("menuindex");Layout.setSidebarMenuActiveLink("click",e.eq(n))}}},a=function(e){top.layer.msg(e,{icon:1})},r=function(e){top.layer.msg(e,{icon:2,shift:6})},s=function(e){top.layer.msg(e)},c=function(e,t){top.layer.confirm(e,{icon:3,title:"操作提示"},function(e){t(),top.layer.close(e)})};return{initNormalPage:function(){e(),t(),i(),n(),o()},initDialogPage:function(){e(),t(),n()},initConfirmation:e,success:a,error:r,info:s,confirm:c}}();jQuery(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")}})});